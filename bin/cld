#!/bin/bash
source /var/cld/bin/include/cldfuncs
#cat /var/cld/bin/include/cldfuncs
[ "$SUDO_USER" = "" ] && SUDO_USER=admin
#mknod -m 777 /dev/fuse c 10 229 2>&1 >/dev/null
echo "Please select VM to enter"
select VM in $(CLOUDS_USER_ALLOWED | grep -i "$1" | grep -i "$2" | grep -i "$3")
do
  CLD_LOGS
  if [ "$VM" = "" ] ; then
   echo "you choosed incorrect VM, please try again and type numbers only"
  elif echo $VM | grep --quiet "STOPPED" ; then
   echo "Sorry, container is not running, probably it's duplicate"
  elif echo $VM | grep --quiet "OFFLINE" ; then
   echo "Sorry, container is OFFLINE, check hypervisor or hosting status"
  elif grep --quiet "$VM" /var/cld/creds/ct_px_hyper_list ; then
    PROXMOX_VARS
    echo
    PROXMOX_MOUNT &>/dev/null &
    PROXMOX_TERMINAL
    PROXMOX_UMOUNT &>/dev/null &
  elif grep --quiet "$VM" /var/cld/creds/ext_*_list ; then
    EXTERNAL_VARS
    echo
    EXTERNAL_MOUNT &>/dev/null &
    EXTERNAL_TERMINAL
    EXTERNAM_UMOUNT &>/dev/null &
  elif grep --quiet "$VM" /var/cld/creds/ct_virtuozzo_hyper_list ; then
    VIRTUOZZO_VARS
    echo
    VIRTUOZZO_MOUNT &>/dev/null &
    VIRTUOZZO_TERMINAL
    VIRTUOZZO_UMOUNT &>/dev/null &
  elif grep --quiet "$VM" /var/cld/creds/ct_vz_hyper_list ; then
    OPENVZ_VARS
    echo
    OPENVZ_MOUNT &>/dev/null &
    OPENVZ_TERMINAL
    OPENVZ_UMOUNT &>/dev/null &
  fi
  break
done

