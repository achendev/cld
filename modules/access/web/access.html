<html lang="en">
   <head>
      <title>cld web - admin</title>
      {% include 'html/include/head.html' %}
   </head>
   <body>
      <div class="page-container">
         <!-- top navbar -->
         {% include 'html/include/navbar.html' %}
         <div class="container">
            <!-- sidebar -->
            <div class="panel-group" id="accordion" style="padding-top: 25;">
               <div class="panel panel-default">
                  <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse1" aria-expanded="true" style="cursor:pointer;">
                     <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                        Access files</a>
                     </h4>
                  </div>
                  <div id="collapse1" class="panel-collapse collapse in">
                     <div class="panel-body">
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.9/ace.js" type="text/javascript" charset="utf-8"></script>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.9/keybinding-sublime.min.js"></script>
                        <script>
                           var editor = [];
                           function aceactivate(file)
                           {
                           ace.edit(file+'Pre', {
                               theme: "ace/theme/monokai",
                               keyboardHandler: "ace/keyboard/sublime",
                               foldStyle: "markbeginend",
                               mode: "ace/mode/markdown",
                               maxLines: 40,
                               minLines: 5,
                               wrap: true,
                               showPrintMargin: false,
                               autoScrollEditorIntoView: true,
                               highlightSelectedWord: true
                           });
                           editor[file+'Pre'] = ace.edit(file+'Pre');
                           editor[file+'Pre'].renderer.setScrollMargin(10, 15, 0, 0);
                           $('#'+file+'Area').val(editor[file+'Pre'].getSession().getValue());
                           editor[file+'Pre'].getSession().on('change', function () {
                              $('#'+file+'Area').val(editor[file+'Pre'].getSession().getValue());
                           });
                           }
                           function sleep (time) {
                             return new Promise((resolve) => setTimeout(resolve, time));
                           }
                           function savefile(id, url) {
                                   $.ajax({
                                       url : url,
                                       type: "POST",
                                       data : $('#'+id).serialize(),
                                       cache: false,
                                       processData:false,
                                       success: function (data) {
                                           $('#'+id+'-button').addClass('btn-success').removeClass('btn-primary');
                                           sleep(500).then(() => {
                                           $('#'+id+'-button').addClass('btn-primary').removeClass('btn-success');
                                           });
                                           console.log('File saved');
                                           },
                                       error: function (data) {
                                           $('#'+id+'-button').addClass('btn-danger').removeClass('btn-primary');
                                           sleep(500).then(() => {
                                           $('#'+id+'-button').addClass('btn-primary').removeClass('btn-danger');
                                           });
                                           console.log('An error occurred while saving data');
                                           }
                                   })
                           
                           }
                        </script>
                        {% for file in files %}
                        {% set fileid = file.replace('/', '_').replace('.', '_') %}
                        <form id="{{ fileid }}">
                           <textarea id="{{ fileid }}Name" name="file" style="display: none;">{{ file }}</textarea>
                           <textarea id="{{ fileid }}Area" name="content" style="display: none;"></textarea>
                        </form>
                        <div class="prefile">{{ file }}</div>
                        <pre id="{{ fileid }}Pre">{{ files[file] }}</pre>
                        <button id="{{ fileid }}-button" onclick="savefile('{{ fileid }}', '{{ url_for('adminsavefile') }}')" class="btn btn-primary bt mb-2">Save {{ file }}</button><br><br>
                        <script>
                           aceactivate('{{ fileid }}')
                        </script>
                        {% endfor %}
                     </div>
                  </div>
               </div>
               <div class="panel panel-default">
                  <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse2" aria-expanded="false" style="cursor:pointer;">
                     <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                        Groups</a>
                     </h4>
                  </div>
               </div>
            </div>
            <!--/.row-->
         </div>
         <!--/.container-->
      </div>
      <!--/.page-container-->
   </body>
</html>