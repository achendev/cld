#!/bin/bash
HELP_DESC=$(cat << 'EOL'
Show list of hypervisors and clouds of cloud manager platform
EOL
)
HELP_ARGS=$(cat << 'EOL'
$1                            First PATTERN filtering allowed clouds
$2                            Second PATTERN filtering allowed clouds
$3                            Third PATTERN filtering allowed clouds
--json                        Json outout option
--beauty                      Using together with --json option to beautify json output
EOL
)
HELP_EXAMPLES=$(cat << 'EOL'
cld-cmclouds
cld-cmclouds --json
EOL
)

source /var/cld/bin/include/cldfuncs
source /var/cld/cm/bin/include/create_funcs
ARG1=$(echo "${@:1}" | tr ' ' '\n' | grep -v '\--' | head -1)
ARG2=$(echo "${@:1}" | tr ' ' '\n' | grep -v '\--' | head -2 | tail -1)
ARG3=$(echo "${@:1}" | tr ' ' '\n' | grep -v '\--' | head -3 | tail -1)

for OPTS in ${@:1}
do
echo $OPTS | grep -q  '^\--hypers=' && HPRS="$(echo $OPTS | cut -d '=' -f 2)"
echo $OPTS | grep -q  '^\--json' && JSON=1
echo $OPTS | grep -q  '^\--beauty' && JSON_BEAUTY=1
done

[ "$JSON_BEAUTY" == "1" -a "$FROM" == "API" ] && JSON_BEAUTY_ARG='| jq . -C'
[ "$JSON_BEAUTY" == "1" -a "$FROM" != "API" ] && JSON_BEAUTY_ARG='| jq .'

if [ "$JSON" == "1" ]
then
get-kvm-list-json
else
get-kvm-list
fi